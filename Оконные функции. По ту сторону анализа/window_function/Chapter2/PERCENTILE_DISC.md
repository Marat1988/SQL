
<div style="text-align: justify;">Функция PERCENTILE_DISC(0.9) в SQL Server использует дискретный алгоритм для вычисления перцентиля. То есть она возвращает фактическое значение из набора данных,
        которое занимает позицию, равную или превышающую 90-й процентиль. Как работает PERCENTILE_DISC(0.9) — основной алгоритм:
        <ol>
            <li>Отсортировать данные по выбранному столбцу (например, Amount).</li>
            <li>Определить позицию (индекс) в отсортированном наборе данных, соответствующую заданному процентилю:
                <div style="display: block; margin: 30px; font-weight: bold;">Position=⌈P×N⌉</div>
                где:
                <ul>
                    <li>P=0.9 (процентиль)</li>
                    <li>N — общее число строк в выборке</li>
                </ul>
            </li>
            <li>Выбрать значение на этой позиции — это и есть результат.</li>
        </ol>
 </div>
<div>Конкретный пример. Допустим, у нас есть 10 отсортированных значений:
        <p style="padding: 10px; background-color: brown; color: white; width: fit-content;">100, 200, 300, 400, 500, 600, 700, 800, 900, 1000</p>
        <div>Общее число N = 10. Для P = 0.9:</div>
        <div style="display: block;  margin: 30px; font-weight: bold;">Position=⌈0.9×10⌉=⌈9⌉=9</div>
        <div>Значение на 9-й позиции — 900. Ответ: PERCENTILE_DISC(0.9) вернёт 900.</div>
        Важные моменты:
        <ul>
            <li>Если количество строк N не делится на 1 (нецелое), алгоритм всё равно использует округление вверх.</li>
            <li>В случае, если P * N — целое число, то выбирается значение на этой позиции.</li>
            <li>Этот алгоритм не интерполирует между значениями, он выбирает фактическое существующее значение.</li>
        </ul>
</div>
<p style="text-align: center; font-weight: bold;">Пример с PERCENTILE_DISC и дробной позицией</p>
<div>Чтобы показать, как PERCENTILE_DISC работает при дробных позициях, возьмем набор данных:</div>

<table border="1px solid">
        <tr>
            <th>id</th>
            <th>value</th>
        </tr>
        <tr>
            <td>1</td>
            <td>10</td>
        </tr>
        <tr>
            <td>2</td>
            <td>20</td>
        </tr>
        <tr>
            <td>3</td>
            <td>30</td>
        </tr>
        <tr>
            <td>4</td>
            <td>40</td>
        </tr>
        <tr>
            <td>5</td>
            <td>50</td>
        </tr>
</table>
<div>Общее число строк: N=5. Расчет 80-го перцентиля (P=0.8). Позиция по формуле:
        <div style="display: block; margin: 30px; font-weight: bold;">Position=P×N=0.8×5=4.0</div>
</div>
<div>Это — целое число, поэтому PERCENTILE_DISC(0.8) — выберет значение, которое находится на позиции 4 в отсортированном наборе. Значения по позициям:
        <ul>
            <li>1-я - 10</li>
            <li>2-я - 20</li>
            <li>3-я - 30</li>
            <li>4-я - 40</li>
            <li>5-я - 50</li>
        </ul>
        Результат: значение на позиции 4 — это 40.
</div>
<p style="text-align: center; font-weight: bold;">Расчет 70-го перцентиля (P=0.7)</p>
<ol>
        <li>Позиция 0.7×5=3.5 Это — дробное число (нецелое). Вот тут важный момент: PERCENTILE_DISC — по стандарту SQL, при дробной позиции выбирается следующее за целой — то есть, округление вверх. Следовательно, позиция — 4 (округление вверх с 3.5).</li>
        <li>Значения. 4-я позиция — 40. Результат: PERCENTILE_DISC(0.7) — это значение на позиции 4, то есть 40.</li>
</ol>
<div>
        Итог:
        <table border="1px solid">
            <tr>
                <th>Процент</th>
                <th>Расчет позиции</th>
                <th>Округление в PERCENTILE_DISC</th>
                <th>Итоговое значение</th>
            </tr>
            <tr>
                <td>80%</td>
                <td>0.8×5=4.00</td>
                <td>— (целое число)</td>
                <td>40</td>
            </tr>
            <tr>
                <td>70%</td>
                <td>0.7×5=3.50</td>
                <td>округление вверх → 4</td>
                <td>40</td>
            </tr>
        </table>
</div>
<div>
        Важное замечание
        <ul>
            <li>В PERCENTILE_DISC при дробной позиции (например, 3.5) всегда берется следующая за целым числом позиция (округление вверх).</li>
            <li>В PERCENTILE_CONT — интерполирует между соседними значениями, и дробные позиции дают интерполированное значение.</li>
        </ul>
</div>